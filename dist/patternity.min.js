(function(h){var l,n=this,e;if(h&&"string"===typeof h)for(h=h.split(".");l=h.shift();)n[l]||(n[l]={}),n=n[l];e=n;var O=this,h=function(a){var b=["[object ",a,"]"].join("");return function(a){return A.call(a)===b}},A=Object.prototype.toString;l={Function:1,Undefined:1,Null:1,String:1,Array:1,Object:1,Math:1,Date:1,Boolean:1,Number:1,RegExp:1,JSON:1,Arguments:1};var i={},g;for(g in l)l.hasOwnProperty(g)&&(i["is"+g]=h(g));var q=function(a){a=A.call(a);return a.substring(8,a.length-1)};g=function(a,b){for(var c=
a.split("."),d=c.shift(),f=O;d;)f[d]||(f[d]={}),0===c.length&&b&&(f[d]=b),f=f[d],d=c.shift();return f};var r=function(a,b){var c,d;if(a&&b){if(B(b)){c=0;for(d=b.length;c<d;c++)r(a,b[c])}else for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}},C=function(a,b){var c,d;if(B(b)){c=0;for(d=b.length;c<d;c++)if(!C(a,b[c]))return!1;return!0}if(P(b)){for(d in b)if(b.hasOwnProperty(d)&&(c=a[d],Q(c)||q(c)!==q(b[d])))return!1;return!0}},B=i.isArray,P=i.isObject,Q=i.isUndefined;e.utils=r(i,{createNS:g,extend:function(a,
b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;return a},mixin:r,pairCall:function(a,b,c){var d;if(i.isFunction(a)&&i.isObject(b)){for(d in b)b.hasOwnProperty(d)&&a.call(c,d,b[d]);return!0}return!1},isImplementing:C,isDefined:function(a){return!i.isNull(a)&&!i.isUndefined(a)},getType:q});e.NS=g;var R=this,D=function(a,b){var c;return function(){var d=this._parent;this._parent=b.prototype;c=a.apply(this,arguments);d?this._parent=d:delete this._parent;return c}},p=function(a,b,c){var d,
f;if(S(b)){d=0;for(f=b.length;d<f;d++)p(a,b[d],c)}else for(d in b)b.hasOwnProperty(d)&&!T[d]&&(f=b[d],m(f)&&b.Extends?a[d]=D(f,b.Extends):(a[d]=f,typeof f===s&&c.push({key:d,value:f})))},F=function(a,b,c){c=c||b.className;t(a)?k.createNS([a,".",c].join(""),b):E(a)?a[c]=b:R[c]=b},G=function(a,b,c){if(!t(a))throw new TypeError("a class name is required");if(!E(b))throw new TypeError(a+": class definition must be an object");if(c&&!t(c)&&typeof c!==s)throw new TypeError(a+": package must be an object or string");
},H=function(a,b,c){b=m(b)?b.prototype:b;if(!k.isImplementing(a.prototype,b))throw Error(c+" implementation for interface is missing");},I=function(a){for(var b=a.length,c;b--;)c=a[b],this[c.key]=c.value.constructor()};g=function(a,b,c){var d,f=[],e,g,h,i;G(a,b,c);e=b.Extends;g=b.Mixin;h=b.Static;i=b.Implements;d=m(b.construct)?function(){f.length&&I.call(this,f);b.construct.apply(this,arguments)}:function(){f.length&&I.call(this,f)};d.className=a;if(m(e)){k.extend(d,e);var a=d.prototype,j;for(j in a)a[j]&&
typeof a[j]===s&&f.push({key:j,value:a[j]});m(b.construct)&&(b.construct=D(b.construct,e))}p(d.prototype,b,f);g&&(m(g)?p(d.prototype,g.prototype,f):p(d.prototype,g,f));i&&H(d,i);h&&k.mixin(d,h);F(c,d);return d};var T={Extends:1,Implements:1,Mixin:1,Static:1,className:1},s="object",k=e.utils,E=k.isObject,t=k.isString,m=k.isFunction,S=k.isArray;g.prototype={isImplementing:H,validateInput:G,mixinProto:p,applyToPackage:F};e.Class=g;var J=function(a){var b=new a;this.getInstance=function(){return b}};
g=function(a,b,c){K.prototype.validateInput(a,b,c);b=new J(e.Class(a,b,{}));K.prototype.applyToPackage(c,b,a);return b};var K=e.Class;g.prototype={Singleton:J};e.Singleton=g;var U=function(a,b){return function(){return a[b].apply(a,arguments)}},M=function(a,b){for(var c in b)if(b.hasOwnProperty(c))if(V(a[c]))this[c]=U(a,c);else throw L="cannot bind "+c+"() implementation is missing",L;};g=function(a,b,c){function d(a){if(a&&W(a))M.call(this,a,b);else throw"an object for interface binding should be defined";
}d.className=a;u.prototype.validateInput(a,b,c);d.bind=function(a){return new d(a)};u.prototype.mixinProto(d.prototype,b);u.prototype.applyToPackage(c,d);return d};var u=e.Class,L,h=e.utils,W=h.isObject,V=h.isFunction;g.prototype={bind:M};e.Interface=g;var X=Array.prototype.slice,v=e.utils,w=v.isFunction;e.Class("Observable",{__observers:{},triggerObservers:function(a){var b=this.__observers[a],c=0,d;if(b){c=0;for(d=b.length;c<d;c++)b[c].apply(this,arguments)}},get:function(a){return this[a]},set:function(a,
b){var c;!v.pairCall(this.set,a,this)&&!w(this[a])&&(c=this[a],this[a]=b,this.triggerObservers(a,b,c))},callFunction:function(a){var b=X.call(arguments,1),c;if(w(this[a]))return c=this[a].apply(this,b),this.triggerObservers(a,c,b),c},observe:function(a,b){var c=this.__observers;v.pairCall(this.observe,a,this)||(c[a]||(c[a]=[]),w(b)&&c[a].push(b))},removeObserver:function(a,b){var c=this.__observers[a]||[],d;for(d=c.length;d--;)if(c[d]===b){c.splice(d,1);break}},removeObservers:function(a){var b=this.__observers;
b[a]&&delete b[a]}},e);e.Interface("IIterable",{first:function(){},next:function(){},currentItem:function(){},isDone:function(){},each:function(){}},e);var x=e.utils;e.Class("Iterator",{Implements:e.IIterable,construct:function(a){if(a instanceof Array)this.__iterable=a;else if(a&&x.isObject(a)){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(a[b]);this.__iterable=c}else if(a&&x.isString(a))this.__iterable=a.split("");else throw"non iterable";this.__index=this.__currentItem=null;this.first()},first:function(){this.__index=
0;return this.currentItem()},next:function(){if(!this.isDone())return this.__index++,this.currentItem()},currentItem:function(){return this.__iterable[this.__index]},isDone:function(){return this.__index===this.__iterable.length},each:function(a){var b=this.__iterable,c=[],d,f=b.length;if(x.isFunction(a))for(d=0;d<f;d++)this.__index=d,c.push(a(b[d],d,b));return c}},e);e.Class("List",{__elements:[],add:function(a){this.__elements.push(a)},getAt:function(a){return this.__elements[a]},indexOf:function(a){for(var b=
this.__elements,c=b.length;c--;)if(b[c]===a)return c;return-1},getLength:function(){return this.__elements.length},hasElement:function(a){return-1!==this.indexOf(a)},removeAt:function(a){-1<a&&this.__elements.splice(a,1)},remove:function(a){for(var b=this.indexOf(a);-1!==b;)this.removeAt(b),b=this.indexOf(a)},getElements:function(){return this.__elements},iterator:function(){return e.IIterable.bind(new e.Iterator(this.__elements))},unique:function(){for(var a=this.__elements,b=a.length,c={},d=[],
f;b--;)f=a[b],c[f]||(d.push(f),c[f]=1);this.__elements=d}},e);e.Class("ListOf",{Extends:e.List,construct:function(a){if("function"===typeof a)this.__of=a;else throw"argument should be a constructor";},add:function(a){if(a instanceof this.__of||a.constructor&&a.constructor===this.__of)this._parent.add.call(this,a);else throw"not allowed type";},execute:function(a){var b=Array.prototype.slice.call(arguments,1),c=[];this.iterator().each(function(d){c.push(d[a].apply(d,b))});return c},setAll:function(a,
b){this.iterator().each(function(c){c[a]=b})}},e);var y=e.utils,z=y.isFunction,Y=y.isObject;e.Class("Listenable",{__registry:{},addListener:function(a,b){var c=this.__registry;if(!y.pairCall(this.addListener,a,this))if(b&&(z(b)||Y(b)))c[a]||(c[a]=[]),c[a].push(b);else throw"listener has to be a function or an object";},removeListener:function(a,b){var c=this.__registry[a],d;if(c)for(d=c.length;d--;)if(c[d]===b){c.splice(d,1);break}},removeListeners:function(a){var b=this.__registry;b[a]&&delete b[a]},
dispatchEvent:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.__registry[a],d,f,e;if(c){f=0;for(e=c.length;f<e;f++)d=c[f],z(d)?d.apply(this,b):z(d[a])&&d[a].apply(d,b)}}},e);var Z=function(a){var b=(new Date).getTime(),c,d,f;d=0;for(f=a.length;d<f;d++)c=a[d],c.action.call(c.ctx||this,b)};e.Class("Scheduler",{construct:function(a){if("number"===typeof a&&0<a)this.__interval=a,this.__tasks=[],this.__isRunning=!1,this.__handle=null;else throw"interval required";},addTask:function(a,
b){if("function"===typeof a)this.__tasks.push({action:a,ctx:b});else throw"taks must be a function";},interval:function(a){this.__interval=a},removeTask:function(a){for(var b=this.__tasks,c=b.length;c--;)if(b[c].action===a){b.splice(c,1);break}},reset:function(){this.stop();this.__tasks=[]},run:function(a){var b=this;a&&b.addTask(a);b.__isRunning=!0;b.__handle=setInterval(function(){b.__isRunning&&Z(b.__tasks)},b.__interval)},stop:function(){this.__isRunning=!1;clearInterval(this.__handle)},isRunning:function(){return this.__isRunning}},
e);var $=function(){return""+this.__length++},N=function(a){a.handler.apply(a.ctx||this,a.args);a.clearAspect()};e.Class("Sync",{construct:function(a){a=a||{};this.__registry={};this.__length=0;this.__synchronize=a.synchronize||!1;"function"===typeof a.onAllReady&&(this.onAllReady=a.onAllReady)},isAllReady:function(){var a=this.__registry,b;for(b in a)if(a.hasOwnProperty(b)&&!a[b].isReady)return!1;return!0},clear:function(){this.__registry={};this.__length=0},addHandler:function(a,b,c){var d=this,
f=a[b],e,g,c=c||a;"function"===typeof f&&(e=$.call(d),a[b]=function(){var h,i=d.__synchronize,j=d.__registry;if(g=j[e]){if(g.isReady=!0,g.args=arguments,i||(N(g),delete j[e]),d.isAllReady()){if(i)for(h in j)j.hasOwnProperty(h)&&(N(j[h]),delete j[h]);if(d.onAllReady)d.onAllReady()}}else f.apply(c||this,arguments),a[b]=f},d.__registry[e]={handler:f,clearAspect:function(){a[b]=f},ctx:c||a,isReady:!1})},onAllReady:function(){}},e)})("py");
